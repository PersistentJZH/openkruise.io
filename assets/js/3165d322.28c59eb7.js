"use strict";(self.webpackChunkopenkruise_io=self.webpackChunkopenkruise_io||[]).push([[9022],{3905:function(e,a,t){t.d(a,{Zo:function(){return u},kt:function(){return f}});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),c=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):s(s({},a),e)),t},u=function(e){var a=c(e.components);return n.createElement(i.Provider,{value:a},e.children)},m={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},p=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(t),f=r,g=p["".concat(i,".").concat(f)]||p[f]||m[f]||o;return t?n.createElement(g,s(s({ref:a},u),{},{components:t})):n.createElement(g,s({ref:a},u))}));function f(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,s=new Array(o);s[0]=p;var l={};for(var i in a)hasOwnProperty.call(a,i)&&(l[i]=a[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var c=2;c<o;c++)s[c]=t[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}p.displayName="MDXCreateElement"},7711:function(e,a,t){t.r(a),t.d(a,{assets:function(){return u},contentTitle:function(){return i},default:function(){return f},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return m}});var n=t(7462),r=t(3366),o=(t(7294),t(3905)),s=["components"],l={},i="Gameservers Scale",c={unversionedId:"user-manuals/gameservers-scale",id:"user-manuals/gameservers-scale",title:"Gameservers Scale",description:"The scaling feature of OpenKruiseGame",source:"@site/kruisegame/user-manuals/gameservers-scale.md",sourceDirName:"user-manuals",slug:"/user-manuals/gameservers-scale",permalink:"/kruisegame/user-manuals/gameservers-scale",draft:!1,tags:[],version:"current",lastUpdatedBy:"skkkkkkk",lastUpdatedAt:1681291192,formattedLastUpdatedAt:"4/12/2023",frontMatter:{},sidebar:"kruisegame",previous:{title:"Update Strategy",permalink:"/kruisegame/user-manuals/update-strategy"},next:{title:"Startup Sequence Control",permalink:"/kruisegame/user-manuals/container-startup-sequence-control"}},u={},m=[{value:"The scaling feature of OpenKruiseGame",id:"the-scaling-feature-of-openkruisegame",level:2},{value:"Examples",id:"examples",level:3},{value:"Configure the auto scaling feature for a game server",id:"configure-the-auto-scaling-feature-for-a-game-server",level:2},{value:"HPA example",id:"hpa-example",level:3}],p={toc:m};function f(e){var a=e.components,t=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,n.Z)({},p,t,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"gameservers-scale"},"Gameservers Scale"),(0,o.kt)("h2",{id:"the-scaling-feature-of-openkruisegame"},"The scaling feature of OpenKruiseGame"),(0,o.kt)("p",null,"OpenKruiseGame allows you to set the states of game servers. You can manually set the value of opsState or DeletionPriority for a game server. You can also use the service quality feature to automatically set the value of opsState or DeletionPriority for a game server. During scale-in, a proper GameServerSet workload is selected for scale-in based on the states of game servers. The scale-in rules are as follows:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Scale in game servers based on the opsState values. Scale in the game servers for which the opsState values are ",(0,o.kt)("inlineCode",{parentName:"p"},"WaitToBeDeleted"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"None"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"Maintaining")," in sequence.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If two or more game servers have the same opsState value, game servers are performed based on the values of DeletionPriority. The game server with the largest DeletionPriority value is deleted first.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"If two or multiple game servers have the same opsState value and DeletionPriority value, the game server whose name contains the largest sequence number in the end is deleted first."))),(0,o.kt)("h3",{id:"examples"},"Examples"),(0,o.kt)("p",null,"Deploy a game server with five replicas:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cat <<EOF | kubectl apply -f -\napiVersion: game.kruise.io/v1alpha1\nkind: GameServerSet\nmetadata:\n  name: minecraft\n  namespace: default\nspec:\n  replicas: 5\n  updateStrategy:\n    rollingUpdate:\n      podUpdatePolicy: InPlaceIfPossible\n  gameServerTemplate:\n    spec:\n      containers:\n        - image: registry.cn-hangzhou.aliyuncs.com/acs/minecraft-demo:1.12.2\n          name: minecraft\nEOF\n")),(0,o.kt)("p",null,"Five game servers are generated:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get gs\nNAME          STATE   OPSSTATE   DP    UP\nminecraft-0   Ready   None       0     0\nminecraft-1   Ready   None       0     0\nminecraft-2   Ready   None       0     0\nminecraft-3   Ready   None       0     0\nminecraft-4   Ready   None       0     0\n")),(0,o.kt)("p",null,"Set DeletionPriority to 10 for minecraft-2:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl edit gs minecraft-2\n\n...\nspec:\n  DeletionPriority: 10 # Change the value of DeletionPriority from the initial value 0 to 10.\n  opsState: None\n  updatePriority: 0\n...\n")),(0,o.kt)("p",null,"Manually perform scale-in to reduce the number of the game servers to 4:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl scale gss minecraft --replicas=4\ngameserverset.game.kruise.io/minecraft scale\n")),(0,o.kt)("p",null,"The number of the game servers is changed to 4. The following example shows that minecraft-2 is deleted because it has the largest DeletionPriority value."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get gs\nNAME          STATE      OPSSTATE   DP    UP\nminecraft-0   Ready      None       0     0\nminecraft-1   Ready      None       0     0\nminecraft-2   Deleting   None       10    0\nminecraft-3   Ready      None       0     0\nminecraft-4   Ready      None       0     0\n\n# After a while\n...\n\nkubectl get gs\nNAME          STATE   OPSSTATE   DP    UP\nminecraft-0   Ready   None       0     0\nminecraft-1   Ready   None       0     0\nminecraft-3   Ready   None       0     0\nminecraft-4   Ready   None       0     0\n")),(0,o.kt)("p",null,"Set opsState to WaitToBeDeleted for minecraft-3:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl edit gs minecraft-3\n\n...\nspec:\n  deletionPriority: 0\n  opsState: WaitToBeDeleted # Change the value of opsState from the initial value None to WaitToBeDeleted.\n  updatePriority: 0\n...\n")),(0,o.kt)("p",null,"Manually perform scale-in to reduce the number of the game servers to 3:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl scale gss minecraft --replicas=3\ngameserverset.game.kruise.io/minecraft scaled\n")),(0,o.kt)("p",null,"The number of replicas for the game server is changed to 3. You can see that minecraft-3 is deleted because its opsState value is WaitToBeDeleted."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get gs\nNAME          STATE      OPSSTATE          DP    UP\nminecraft-0   Ready      None              0     0\nminecraft-1   Ready      None              0     0\nminecraft-3   Deleting   WaitToBeDeleted   0     0\nminecraft-4   Ready      None              0     0\n\n# After a while\n...\n\nkubectl get gs\nNAME          STATE   OPSSTATE   DP    UP\nminecraft-0   Ready   None       0     0\nminecraft-1   Ready   None       0     0\nminecraft-4   Ready   None       0     0\n")),(0,o.kt)("p",null,"Manually perform scale-out and change the number of replicas for the game server back to 5:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl scale gss minecraft --replicas=5\ngameserverset.game.kruise.io/minecraft scaled\n")),(0,o.kt)("p",null,"The number of replicas for the game server is changed back to 5. You can see that minecraft-2 and minecraft-3 are added for the game server."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl get gs\nNAME          STATE   OPSSTATE   DP    UP\nminecraft-0   Ready   None       0     0\nminecraft-1   Ready   None       0     0\nminecraft-2   Ready   None       0     0\nminecraft-3   Ready   None       0     0\nminecraft-4   Ready   None       0     0\n")),(0,o.kt)("h2",{id:"configure-the-auto-scaling-feature-for-a-game-server"},"Configure the auto scaling feature for a game server"),(0,o.kt)("p",null,"GameServerSet supports Horizontal Pod Autoscaler (HPA). You can configure this feature based on the default or custom metrics."),(0,o.kt)("h3",{id:"hpa-example"},"HPA example"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: minecraft-hpa\nspec:\n  scaleTargetRef:\n    apiVersion: game.kruise.io/v1alpha1\n    kind: GameServerSet\n    name: minecraft # The name of GameServerSet\n  minReplicas: 1\n  maxReplicas: 10\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      target:\n        type: Utilization\n        averageUtilization: 50 # The CPU utilization 50% is used for calculation in this example.\n")))}f.isMDXComponent=!0}}]);