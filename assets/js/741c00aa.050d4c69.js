"use strict";(self.webpackChunkopenkruise_io=self.webpackChunkopenkruise_io||[]).push([[2070],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=u(n),m=a,k=c["".concat(s,".").concat(m)]||c[m]||d[m]||o;return n?r.createElement(k,l(l({ref:t},p),{},{components:n})):r.createElement(k,l({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=c;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}c.displayName="MDXCreateElement"},246:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return i},metadata:function(){return u},toc:function(){return d}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),l=["components"],i={},s="Network",u={unversionedId:"user-manuals/network",id:"user-manuals/network",title:"Network",description:"Feature overview",source:"@site/kruisegame/user-manuals/network.md",sourceDirName:"user-manuals",slug:"/user-manuals/network",permalink:"/kruisegame/user-manuals/network",draft:!1,tags:[],version:"current",lastUpdatedBy:"skkkkkkk",lastUpdatedAt:1681355333,formattedLastUpdatedAt:"4/13/2023",frontMatter:{},sidebar:"kruisegame",previous:{title:"Service Qualities",permalink:"/kruisegame/user-manuals/service-qualities"},next:{title:"contribution",permalink:"/kruisegame/developer-manuals/contribution"}},p={},d=[{value:"Feature overview",id:"feature-overview",level:2},{value:"Example",id:"example",level:2},{value:"Kubernetes-HostPort",id:"kubernetes-hostport",level:3},{value:"AlibabaCloud-NATGW",id:"alibabacloud-natgw",level:3},{value:"Network plugins",id:"network-plugins",level:2},{value:"Kubernetes-HostPort",id:"kubernetes-hostport-1",level:3},{value:"Plugin name",id:"plugin-name",level:4},{value:"Cloud Provider",id:"cloud-provider",level:4},{value:"Plugin description",id:"plugin-description",level:4},{value:"Network parameters",id:"network-parameters",level:4},{value:"Plugin configuration",id:"plugin-configuration",level:4},{value:"AlibabaCloud-NATGW",id:"alibabacloud-natgw-1",level:3},{value:"Plugin name",id:"plugin-name-1",level:4},{value:"Cloud Provider",id:"cloud-provider-1",level:4},{value:"Plugin description",id:"plugin-description-1",level:4},{value:"Network parameters",id:"network-parameters-1",level:4},{value:"Plugin configuration",id:"plugin-configuration-1",level:4},{value:"AlibabaCloud-SLB",id:"alibabacloud-slb",level:3},{value:"Plugin name",id:"plugin-name-2",level:4},{value:"Cloud Provider",id:"cloud-provider-2",level:4},{value:"Plugin description",id:"plugin-description-2",level:4},{value:"Network parameters",id:"network-parameters-2",level:4},{value:"Plugin configuration",id:"plugin-configuration-2",level:4},{value:"AlibabaCloud-SLB-SharedPort",id:"alibabacloud-slb-sharedport",level:3},{value:"Plugin name",id:"plugin-name-3",level:4},{value:"Cloud Provider",id:"cloud-provider-3",level:4},{value:"Plugin description",id:"plugin-description-3",level:4},{value:"Network parameters",id:"network-parameters-3",level:4},{value:"Plugin configuration",id:"plugin-configuration-3",level:4}],c={toc:d};function m(e){var t=e.components,n=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"network"},"Network"),(0,o.kt)("h2",{id:"feature-overview"},"Feature overview"),(0,o.kt)("p",null,"As mentioned in ",(0,o.kt)("a",{parentName:"p",href:"/kruisegame/design-concept"},"Design concept of OpenKruiseGame"),", the access network of game servers is the main concern of game developers.\nFor a non-gateway architecture, game developers need to consider how to expose external IP addresses and ports of game servers for access by players.\nDifferent network products are usually required for access in different scenarios, and the network products may be provided by different cloud service providers. This increases the complexity of the access network. Cloud Provider & Network Plugin of OpenKruiseGame is designed to resolve this issue.\nOpenKruiseGame integrates different network plugins of different cloud service providers. You can use GameServerSet to set network parameters for game servers. Moreover, you can view network status information in the generated GameServer. This significantly reduces the complexity of the access network of game servers."),(0,o.kt)("h2",{id:"example"},"Example"),(0,o.kt)("h3",{id:"kubernetes-hostport"},"Kubernetes-HostPort"),(0,o.kt)("p",null,"OpenKruiseGame allows game servers to use the HostPort network in native Kubernetes clusters. The host where game servers are located exposes its external IP address and ports by using which Internet traffic is forwarded to the internal ports of the game servers. The following example shows the details:"),(0,o.kt)("p",null,"Deploy the GameServerSet object that contains the network field."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'cat <<EOF | kubectl apply -f -\napiVersion: game.kruise.io/v1alpha1\nkind: GameServerSet\nmetadata:\n  name: gs-hostport\n  namespace: default\nspec:\n  replicas: 1\n  updateStrategy:\n    rollingUpdate:\n      podUpdatePolicy: InPlaceIfPossible\n  network:\n    networkType: Kubernetes-HostPort\n    networkConf:\n    # The network configuration is specified in the form of a key-value pair. The network configuration is determined by the network plugin. Different network plugins correspond to different network configurations.\n    - name: ContainerPorts\n      # The value of ContainerPorts is in the following format: {containerName}:{port1}/{protocol1},{port2}/{protocol2},...\n      value: "gameserver:80"\n  gameServerTemplate:\n    spec:\n      containers:\n        - image: registry.cn-hangzhou.aliyuncs.com/gs-demo/gameserver:network\n          name: gameserver\nEOF\n')),(0,o.kt)("p",null,"Use the networkStatus field in the generated GameServer to view the network status information of the game server."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'  networkStatus:\n    createTime: "2022-11-23T10:57:01Z"\n    currentNetworkState: Ready\n    desiredNetworkState: Ready\n    externalAddresses:\n    - ip: 48.98.98.8\n      ports:\n      - name: gameserver-80\n        port: 8211\n        protocol: TCP\n    internalAddresses:\n    - ip: 172.16.0.8\n      ports:\n      - name: gameserver-80\n        port: 80\n        protocol: TCP\n    lastTransitionTime: "2022-11-23T10:57:01Z"\n    networkType: Kubernetes-HostPort\n')),(0,o.kt)("p",null,"Clients can access the game server by using 48.98.98.8:8211."),(0,o.kt)("h3",{id:"alibabacloud-natgw"},"AlibabaCloud-NATGW"),(0,o.kt)("p",null,"OpenKruiseGame supports the NAT gateway model of Alibaba Cloud. A NAT gateway exposes its external IP addresses and ports by using which Internet traffic is forwarded to pods. The following example shows the details:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'cat <<EOF | kubectl apply -f -\napiVersion: game.kruise.io/v1alpha1\nkind: GameServerSet\nmetadata:\n  name: gs-natgw\n  namespace: default\nspec:\n  replicas: 1\n  updateStrategy:\n    rollingUpdate:\n      podUpdatePolicy: InPlaceIfPossible\n  network:\n    networkType: AlibabaCloud-NATGW\n    networkConf:\n    - name: Ports\n      # The ports to be exposed. The value is in the following format: {port1},{port2}...\n      value: "80"\n    - name: Protocol\n      # The protocol. The value is TCP by default.\n      value: "TCP"\n#   - name: Fixed\n# Specify whether the mapping relationship is fixed. By default, the mapping relationship is not fixed, that is, a new external IP address and port are generated after the pod is deleted.\n#     value: true\n  gameServerTemplate:\n    spec:\n      containers:\n        - image: registry.cn-hangzhou.aliyuncs.com/gs-demo/gameserver:network\n          name: gameserver\nEOF\n')),(0,o.kt)("p",null,"Use the networkStatus field in the generated GameServer to view the network status information of the game server."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'  networkStatus:\n    createTime: "2022-11-23T11:21:34Z"\n    currentNetworkState: Ready\n    desiredNetworkState: Ready\n    externalAddresses:\n    - ip: 47.97.227.137\n      ports:\n      - name: "80"\n        port: "512"\n        protocol: TCP\n    internalAddresses:\n    - ip: 172.16.0.189\n      ports:\n      - name: "80"\n        port: "80"\n        protocol: TCP\n    lastTransitionTime: "2022-11-23T11:21:34Z"\n    networkType: AlibabaCloud-NATGW\n')),(0,o.kt)("p",null,"Clients can access the game server by using 47.97.227.137:512."),(0,o.kt)("h2",{id:"network-plugins"},"Network plugins"),(0,o.kt)("p",null,"OpenKruiseGame supports the following network plugins:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Kubernetes-HostPort"),(0,o.kt)("li",{parentName:"ul"},"AlibabaCloud-NATGW"),(0,o.kt)("li",{parentName:"ul"},"AlibabaCloud-SLB"),(0,o.kt)("li",{parentName:"ul"},"AlibabaCloud-SLB-SharedPort")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"kubernetes-hostport-1"},"Kubernetes-HostPort"),(0,o.kt)("h4",{id:"plugin-name"},"Plugin name"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Kubernetes-HostPort")),(0,o.kt)("h4",{id:"cloud-provider"},"Cloud Provider"),(0,o.kt)("p",null,"Kubernetes"),(0,o.kt)("h4",{id:"plugin-description"},"Plugin description"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"HostPort enables game servers to be accessed from the Internet by forwarding Internet traffic to the game servers by using the external IP address and ports exposed by the host where the game servers are located. The exposed IP address of the host must be a public IP address so that the host can be accessed from the Internet.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"In the configuration file, you can specify a custom range of available host ports. The default port range is 8000 to 9000. This network plugin can help you allocate and manage host ports to prevent port conflicts.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"This network plugin does not support network isolation."))),(0,o.kt)("h4",{id:"network-parameters"},"Network parameters"),(0,o.kt)("p",null,"ContainerPorts"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: the name of the container that provides services, the ports to be exposed, and the protocols."),(0,o.kt)("li",{parentName:"ul"},"Value: in the format of containerName:port1/protocol1,port2/protocol2,... The protocol names must be in uppercase letters. Example: ",(0,o.kt)("inlineCode",{parentName:"li"},"game-server:25565/TCP"),"."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: no. The value of this parameter is effective until the pod lifecycle ends.")),(0,o.kt)("h4",{id:"plugin-configuration"},"Plugin configuration"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[kubernetes]\nenable = true\n[kubernetes.hostPort]\n# Specify the range of available ports of the host. Ports in this range can be used to forward Internet traffic to pods.\nmax_port = 9000\nmin_port = 8000\n")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"alibabacloud-natgw-1"},"AlibabaCloud-NATGW"),(0,o.kt)("h4",{id:"plugin-name-1"},"Plugin name"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"AlibabaCloud-NATGW")),(0,o.kt)("h4",{id:"cloud-provider-1"},"Cloud Provider"),(0,o.kt)("p",null,"AlibabaCloud"),(0,o.kt)("h4",{id:"plugin-description-1"},"Plugin description"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"AlibabaCloud-NATGW enables game servers to be accessed from the Internet by using an Internet NAT gateway of Alibaba Cloud. Internet traffic is forwarded to the corresponding game servers based on DNAT rules.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"This network plugin does not support network isolation."))),(0,o.kt)("h4",{id:"network-parameters-1"},"Network parameters"),(0,o.kt)("p",null,"Ports"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: the ports in the pod to be exposed."),(0,o.kt)("li",{parentName:"ul"},"Value: in the format of port1,port2,port3\u2026 Example: 80,8080,8888."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: no.")),(0,o.kt)("p",null,"Protocol"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: the network protocol."),(0,o.kt)("li",{parentName:"ul"},"Value: an example value can be tcp. The value is tcp by default."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: no.")),(0,o.kt)("p",null,"Fixed"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: whether the mapping relationship is fixed. If the mapping relationship is fixed, the mapping relationship remains unchanged even if the pod is deleted and recreated."),(0,o.kt)("li",{parentName:"ul"},"Value: false or true."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: no.")),(0,o.kt)("h4",{id:"plugin-configuration-1"},"Plugin configuration"),(0,o.kt)("p",null,"None"),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"alibabacloud-slb"},"AlibabaCloud-SLB"),(0,o.kt)("h4",{id:"plugin-name-2"},"Plugin name"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"AlibabaCloud-SLB")),(0,o.kt)("h4",{id:"cloud-provider-2"},"Cloud Provider"),(0,o.kt)("p",null,"AlibabaCloud"),(0,o.kt)("h4",{id:"plugin-description-2"},"Plugin description"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"AlibabaCloud-SLB enables game servers to be accessed from the Internet by using Layer 4 Classic Load Balancer (CLB) of Alibaba Cloud. CLB is a type of Server Load Balancer (SLB). AlibabaCloud-SLB uses different ports of the same CLB instance to forward Internet traffic to different game servers. The CLB instance only forwards traffic, but does not implement load balancing.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"This network plugin supports network isolation."))),(0,o.kt)("p",null,"Related design: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/openkruise/kruise-game/issues/20"},"https://github.com/openkruise/kruise-game/issues/20")),(0,o.kt)("h4",{id:"network-parameters-2"},"Network parameters"),(0,o.kt)("p",null,"SlbIds"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: the CLB instance ID. You can specify only one CLB instance ID. Multiple CLB instance IDs will be supported in the future."),(0,o.kt)("li",{parentName:"ul"},"Value: an example value can be lb-9zeo7prq1m25ctpfrw1m7."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: no. The configuration change can be supported in future.")),(0,o.kt)("p",null,"PortProtocols"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: the ports in the pod to be exposed and the protocols. You can specify multiple ports and protocols."),(0,o.kt)("li",{parentName:"ul"},"Value: in the format of port1/protocol1,port2/protocol2,... The protocol names must be in uppercase letters."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: no. The configuration change can be supported in future.")),(0,o.kt)("p",null,"Fixed"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: whether the mapping relationship is fixed. If the mapping relationship is fixed, the mapping relationship remains unchanged even if the pod is deleted and recreated."),(0,o.kt)("li",{parentName:"ul"},"Value: false or true."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: no.")),(0,o.kt)("h4",{id:"plugin-configuration-2"},"Plugin configuration"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[alibabacloud]\nenable = true\n[alibabacloud.slb]\n# Specify the range of available ports of the CLB instance. Ports in this range can be used to forward Internet traffic to pods. In this example, the range includes 200 ports.\nmax_port = 700\nmin_port = 500\n")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"alibabacloud-slb-sharedport"},"AlibabaCloud-SLB-SharedPort"),(0,o.kt)("h4",{id:"plugin-name-3"},"Plugin name"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"AlibabaCloud-SLB-SharedPort")),(0,o.kt)("h4",{id:"cloud-provider-3"},"Cloud Provider"),(0,o.kt)("p",null,"AlibabaCloud"),(0,o.kt)("h4",{id:"plugin-description-3"},"Plugin description"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"AlibabaCloud-SLB-SharedPort enables game servers to be accessed from the Internet by using Layer 4 CLB of Alibaba Cloud. Unlike AlibabaCloud-SLB, ",(0,o.kt)("inlineCode",{parentName:"p"},"AlibabaCloud-SLB-SharedPort")," uses the same port of a CLB instance to forward traffic to game servers, and the CLB instance implements load balancing.\nThis network plugin applies to stateless network services, such as proxy or gateway, in gaming scenarios.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"This network plugin supports network isolation."))),(0,o.kt)("h4",{id:"network-parameters-3"},"Network parameters"),(0,o.kt)("p",null,"SlbIds"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: the CLB instance IDs. You can specify multiple CLB instance IDs."),(0,o.kt)("li",{parentName:"ul"},"Value: an example value can be lb-9zeo7prq1m25ctpfrw1m7."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: yes.")),(0,o.kt)("p",null,"PortProtocols"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Meaning: the ports in the pod to be exposed and the protocols. You can specify multiple ports and protocols."),(0,o.kt)("li",{parentName:"ul"},"Value: in the format of port1/protocol1,port2/protocol2,... The protocol names must be in uppercase letters."),(0,o.kt)("li",{parentName:"ul"},"Configuration change supported or not: no. The configuration change can be supported in future.")),(0,o.kt)("h4",{id:"plugin-configuration-3"},"Plugin configuration"),(0,o.kt)("p",null,"None"))}m.isMDXComponent=!0}}]);