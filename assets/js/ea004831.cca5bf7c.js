"use strict";(self.webpackChunkopenkruise_io=self.webpackChunkopenkruise_io||[]).push([[1633],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return c}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var u=n.createContext({}),l=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=l(r),c=a,g=m["".concat(u,".").concat(c)]||m[c]||d[c]||o;return r?n.createElement(g,i(i({ref:t},p),{},{components:r})):n.createElement(g,i({ref:t},p))}));function c(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=m;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=r[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},5954:function(e,t,r){r.r(t),r.d(t,{assets:function(){return p},contentTitle:function(){return u},default:function(){return c},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return d}});var n=r(7462),a=r(3366),o=(r(7294),r(3905)),i=["components"],s={},u="Update Strategy",l={unversionedId:"user-manuals/update-strategy",id:"user-manuals/update-strategy",title:"Update Strategy",description:"Feature overview",source:"@site/kruisegame/user-manuals/update-strategy.md",sourceDirName:"user-manuals",slug:"/user-manuals/update-strategy",permalink:"/kruisegame/user-manuals/update-strategy",draft:!1,tags:[],version:"current",lastUpdatedBy:"skkkkkkk",lastUpdatedAt:1681291192,formattedLastUpdatedAt:"4/12/2023",frontMatter:{},sidebar:"kruisegame",previous:{title:"Hot Update",permalink:"/kruisegame/user-manuals/hot-update"},next:{title:"Gameservers Scale",permalink:"/kruisegame/user-manuals/gameservers-scale"}},p={},d=[{value:"Feature overview",id:"feature-overview",level:2},{value:"Example",id:"example",level:2}],m={toc:d};function c(e){var t=e.components,s=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},m,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"update-strategy"},"Update Strategy"),(0,o.kt)("h2",{id:"feature-overview"},"Feature overview"),(0,o.kt)("p",null,"OpenKruiseGame provides multiple update policies, including in-place update (used to implement ",(0,o.kt)("a",{parentName:"p",href:"/kruisegame/user-manuals/hot-update"},"hot update"),"), batch update, and update by priority."),(0,o.kt)("p",null,"You can set the updatePriority and partition parameters to control the update scope, sequence, and pace in actual production scenarios.\nAs shown in the following figure, if you raise the priority of GameServer-1 and set the partition parameter to 2, GameServer-1 is updated first. Then, if you change the value of the partition parameter to 0, the remaining game servers are updated. For more information, see the following example."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"update-priority.png",src:r(9868).Z,width:"667",height:"257"})),(0,o.kt)("h2",{id:"example"},"Example"),(0,o.kt)("p",null,"A group of game servers are updated in two batches to simulate a canary update."),(0,o.kt)("p",null,"The GameServerSet consists of three game server replicas."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get gs\nNAME        STATE      OPSSTATE   DP    UP\ngs-demo-0   Ready      None       0     0\ngs-demo-1   Ready      None       0     0\ngs-demo-2   Ready      None       0     0\n")),(0,o.kt)("p",null,"Set the updatePriority parameter to a greater value for the game server gs-demo-1."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl edit gs gs-demo-1\n\n...\nspec:\n  deletionPriority: 0\n  opsState: None\n  updatePriority: 10 # The initial value is 0. Change the value to 10.\n...\n")),(0,o.kt)("p",null,"Set the partition parameter and the latest image used to trigger an update operation."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl edit gss gs-demo\n\n...\n        image: gameserver:latest # Set the latest image.\n        name: gameserver\n...\n  updateStrategy:\n    rollingUpdate:\n      maxUnavailable: 5\n      partition: 2 # Set the number of game servers that do not need to be updated to 2 because only one game server needs to be updated.\n      podUpdatePolicy: InPlaceIfPossible\n...\n\n")),(0,o.kt)("p",null,"In this case, only the game server gs-demo-1 is updated."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get gs\nNAME        STATE      OPSSTATE   DP    UP\ngs-demo-0   Ready      None       0     0\ngs-demo-1   Updating   None       0     10\ngs-demo-2   Ready      None       0     0\n\n\n# Wait for a period of time.\n...\n\nkubectl get gs\nNAME        STATE      OPSSTATE   DP    UP\ngs-demo-0   Ready      None       0     0\ngs-demo-1   Ready      None       0     10\ngs-demo-2   Ready      None       0     0\n")),(0,o.kt)("p",null,"After you verify that the game server gs-demo-1 is updated, update the remaining game servers."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl edit gss gs-demo\n...\n  updateStrategy:\n    rollingUpdate:\n      maxUnavailable: 5\n      partition: 0 # Set the number of game servers that do not need to be updated to 0 to update all the remaining game servers.\n      podUpdatePolicy: InPlaceIfPossible\n...\n\n")))}c.isMDXComponent=!0},9868:function(e,t,r){t.Z=r.p+"assets/images/update-priority-6beaaeea676e12846d1c66c854df20b0.png"}}]);